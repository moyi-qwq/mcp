# Moatless MCP Server

[![Python 3.10+](https://img.shields.io/badge/python-3.10+-blue.svg)](https://www.python.org/downloads/)
[![MCP](https://img.shields.io/badge/protocol-MCP-green.svg)](https://modelcontextprotocol.io/)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

ä¸€ä¸ªåŸºäºŽæ¨¡åž‹ä¸Šä¸‹æ–‡åè®® (MCP) çš„é«˜çº§ä»£ç åˆ†æžå’Œç¼–è¾‘æœåŠ¡å™¨ï¼Œæ”¯æŒåŸºäºŽå‘é‡åµŒå…¥çš„è¯­ä¹‰æœç´¢åŠŸèƒ½ã€‚è¯¥æœåŠ¡å™¨ä¸º AI åŠ©æ‰‹æä¾›äº†é€šè¿‡æ ‡å‡†åŒ–æŽ¥å£æ‰§è¡Œå¤æ‚ä»£ç æ“ä½œçš„èƒ½åŠ›ã€‚

## ðŸ†• æœ€æ–°æ›´æ–°ï¼šVerilog åŠŸèƒ½æ”¯æŒ

ä¸ºäº†å¢žå¼ºä»£ç ç”Ÿæˆå’Œå¯è§†åŒ–èƒ½åŠ›ï¼Œæˆ‘ä»¬æ–°å¢žäº† **Verilog ç›¸å…³åŠŸèƒ½**ï¼š

### æ–°å¢žå·¥å…·
- **`verilog_generate`**: é€šè¿‡åœ¨çº¿æœåŠ¡ç”ŸæˆVerilogä»£ç ï¼Œæ ¹æ®é—®é¢˜æè¿°è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„Verilogæ¨¡å—
- **`verilog_v2svg_link`**: å°†Verilogä»£ç è½¬æ¢ä¸ºSVGå›¾ç‰‡é“¾æŽ¥ï¼Œç”Ÿæˆç”µè·¯å›¾çš„SVGæ ¼å¼å›¾ç‰‡

### ä¿®æ”¹çš„æ–‡ä»¶
- **`src/moatless_mcp/tools/verilog_tools.py`**: æ–°å¢žVerilogå·¥å…·å®žçŽ°æ–‡ä»¶
- **`src/moatless_mcp/tools/registry.py`**: åœ¨å·¥å…·æ³¨å†Œè¡¨ä¸­æ·»åŠ Verilogå·¥å…·çš„å¯¼å…¥å’Œæ³¨å†Œ
- **`pyproject.toml`**: æ·»åŠ  `aiohttp>=3.8.0` ä¾èµ–ä»¥æ”¯æŒHTTPè¯·æ±‚

### åŠŸèƒ½ç‰¹ç‚¹
- ðŸ”§ **æ™ºèƒ½ä»£ç ç”Ÿæˆ**: åŸºäºŽè‡ªç„¶è¯­è¨€æè¿°è‡ªåŠ¨ç”ŸæˆVerilogä»£ç 
- ðŸ“Š **å¯è§†åŒ–æ”¯æŒ**: å°†Verilogä»£ç è½¬æ¢ä¸ºSVGç”µè·¯å›¾
- ðŸŒ **åœ¨çº¿æœåŠ¡é›†æˆ**: é€šè¿‡APIè°ƒç”¨å¤–éƒ¨VerilogæœåŠ¡
- âš¡ **å¼‚æ­¥å¤„ç†**: ä½¿ç”¨aiohttpè¿›è¡Œé«˜æ•ˆçš„å¼‚æ­¥HTTPè¯·æ±‚

## æ ¸å¿ƒæž¶æž„ï¼šæ¨¡åž‹ä¸Šä¸‹æ–‡åè®® (MCP)

æœ¬æœåŠ¡å™¨æ˜¯ä¸€ä¸ª**MCPæœåŠ¡å™¨**çš„å®žçŽ°ã€‚MCPæ˜¯ä¸€ä¸ªå¼€æ”¾åè®®ï¼Œæ—¨åœ¨æˆä¸ºè¯­è¨€æ¨¡åž‹ï¼ˆLLMï¼‰ä¸Žå¤–éƒ¨å·¥å…·å’Œæ•°æ®æºä¹‹é—´çš„æ ‡å‡†ä¸­é—´ä»¶ã€‚å®ƒå…è®¸åƒIDEæˆ–èŠå¤©åº”ç”¨è¿™æ ·çš„å®¢æˆ·ç«¯ï¼ˆMCPå®¢æˆ·ç«¯ï¼‰å®‰å…¨ã€åŠ¨æ€åœ°ä¸ŽæœåŠ¡å™¨æä¾›çš„èƒ½åŠ›ï¼ˆå¦‚æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€ä»£ç åˆ†æžï¼‰è¿›è¡Œäº¤äº’ã€‚

### æž¶æž„æµç¨‹

å½“ä¸€ä¸ªMCPå®¢æˆ·ç«¯ï¼ˆå¦‚Claude Desktopæˆ–`cline`ï¼‰è¿žæŽ¥åˆ°æœ¬æœåŠ¡å™¨æ—¶ï¼Œå…¶äº¤äº’éµå¾ªä»¥ä¸‹æµç¨‹ï¼š

```
+------------------+     1. Request (e.g., call_tool)     +-----------------------+
|   MCP Client     | -----------------------------------> |     MCP Server        |
| (IDE, cline etc.)|                                      |     (This Project)    |
+------------------+     6. Response (JSON-RPC)           +-----------+-----------+
        ^          <-----------------------------------          | 2. Dispatch
        |                                                        |
        |                                                        v
        |                                              +-----------------------+
        |                                              |     Tool Registry     |
        |                                              +-----------+-----------+
        |                                                        | 3. Execute Tool
        |                                                        |
        |                                                        v
        |                                              +-----------------------+
        |                                              |      Specific Tool    |
        |                                              | (e.g., ReadFileTool)  |
        |                                              +-----------+-----------+
        |                                                        | 4. Access Data
        |                                                        |
        |   +----------------------------------------------------+
        |   |
        v   v
+-----------------------+     5. Return Data/Result      +-----------------------+
|     Workspace         | <----------------------------- |    Workspace Adapter  |
| (File System, .git)   |                                | (Manages Project State) |
+-----------------------+                                +-----------------------+

```

1.  **è¯·æ±‚(Request)**: å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªJSON-RPCè¯·æ±‚ï¼Œä¾‹å¦‚`tool_run`ï¼Œè¦æ±‚æ‰§è¡Œä¸€ä¸ªåä¸º`read_file`çš„å·¥å…·ã€‚
2.  **åˆ†å‘(Dispatch)**: `server.py`ä¸­çš„MCPæœåŠ¡å™¨æ ¸å¿ƒæŽ¥æ”¶è¯·æ±‚ï¼Œå¹¶å°†å…¶åˆ†æ´¾ç»™`ToolRegistry`ã€‚
3.  **æ‰§è¡Œ(Execute)**: `ToolRegistry`æ‰¾åˆ°åä¸º`read_file`çš„å·²æ³¨å†Œå·¥å…·å®žä¾‹ï¼Œå¹¶è°ƒç”¨å…¶`execute`æ–¹æ³•ã€‚
4.  **æ•°æ®è®¿é—®(Access Data)**: å·¥å…·é€šè¿‡`WorkspaceAdapter`è¯·æ±‚è®¿é—®é¡¹ç›®æ–‡ä»¶ã€‚
5.  **è¿”å›žç»“æžœ(Return Data)**: `WorkspaceAdapter`ä»Žæ–‡ä»¶ç³»ç»Ÿè¯»å–æ•°æ®å¹¶è¿”å›žç»™å·¥å…·ã€‚å·¥å…·å°†ç»“æžœåŒ…è£…æˆ`ToolResult`å¯¹è±¡ã€‚
6.  **å“åº”(Response)**: æœåŠ¡å™¨æ ¸å¿ƒå°†`ToolResult`æ ¼å¼åŒ–ä¸ºJSON-RPCå“åº”ï¼Œå¹¶å°†å…¶å‘é€å›žå®¢æˆ·ç«¯ã€‚

### ç»„ä»¶è¯¦è§£

-   **Server Core (`server.py`)**:
    -   **èŒè´£**: ä½œä¸ºæœåŠ¡å™¨çš„ä¸»å…¥å£ï¼Œç›‘å¬å’Œå“åº”MCPå®¢æˆ·ç«¯çš„è¿žæŽ¥ã€‚
    -   **å®žçŽ°**: ä½¿ç”¨`mcp.server`åº“æ¥å¤„ç†åº•å±‚çš„JSON-RPCé€šä¿¡ã€‚å®ƒå®šä¹‰äº†`list_tools`å’Œ`call_tool`ç­‰åè®®å¤„ç†å™¨ï¼Œå¹¶å°†å…·ä½“çš„é€»è¾‘å§”æ‰˜ç»™`ToolRegistry`ã€‚

-   **Tool Registry (`tools/registry.py`)**:
    -   **èŒè´£**: è´Ÿè´£å·¥å…·çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚å®ƒåœ¨å¯åŠ¨æ—¶å®žä¾‹åŒ–æ‰€æœ‰å¯ç”¨çš„å·¥å…·ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨ä¸€ä¸ªå­—å…¸ä¸­ä»¥ä¾¿å¿«é€Ÿè®¿é—®ã€‚
    -   **å®žçŽ°**: `ToolRegistry`ç±»åŒ…å«ä¸€ä¸ª`_register_default_tools`æ–¹æ³•ï¼Œç”¨äºŽé›†ä¸­æ³¨å†Œæ‰€æœ‰å·¥å…·ã€‚å½“`execute_tool`è¢«è°ƒç”¨æ—¶ï¼Œå®ƒä¼šæŸ¥æ‰¾å¹¶æ‰§è¡Œç›¸åº”çš„å·¥å…·ã€‚

-   **Workspace Adapter (`adapters/workspace.py`)**:
    -   **èŒè´£**: ä½œä¸ºæ–‡ä»¶ç³»ç»Ÿå’Œé¡¹ç›®çŠ¶æ€çš„æŠ½è±¡å±‚ã€‚æ‰€æœ‰å¯¹é¡¹ç›®æ–‡ä»¶çš„ï¿½ï¿½ã€å†™ã€æœç´¢æ“ä½œéƒ½å¿…é¡»é€šè¿‡è¿™ä¸ªé€‚é…å™¨è¿›è¡Œã€‚
    -   **å®žçŽ°**: `WorkspaceAdapter`ç±»æä¾›äº†å¯¹æ–‡ä»¶ã€Gitä»“åº“å’ŒMoatlessè¯­ä¹‰ç´¢å¼•çš„è®¿é—®æŽ¥å£ï¼ŒåŒæ—¶å¼ºåˆ¶æ‰§è¡Œå®‰å…¨ç­–ç•¥ï¼ˆå¦‚æ–‡ä»¶ç±»åž‹å’Œè·¯å¾„é™åˆ¶ï¼‰ã€‚

-   **Tools (`tools/*.py`)**:
    -   **èŒè´£**: å®žçŽ°å…·ä½“çš„ä¸šåŠ¡é€»è¾‘å•å…ƒã€‚æ¯ä¸ªå·¥å…·éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç±»ï¼Œè´Ÿè´£ä¸€é¡¹ç‰¹å®šçš„ä»»åŠ¡ï¼Œå¦‚è¯»å†™æ–‡ä»¶ã€ä»£ç æœç´¢æˆ–è¿è¡Œæµ‹è¯•ã€‚
    -   **å®žçŽ°**: æ‰€æœ‰å·¥å…·éƒ½ç»§æ‰¿è‡ª`MCPTool`åŸºç±»(`tools/base.py`)ï¼Œå¹¶å®žçŽ°`execute`æ–¹æ³•ã€‚å®ƒä»¬é€šè¿‡æž„é€ å‡½æ•°æŽ¥æ”¶`WorkspaceAdapter`çš„å®žä¾‹æ¥ä¸Žé¡¹ç›®æ•°æ®äº¤äº’ã€‚

-   **Vector System & Tree-sitter (`vector/`, `treesitter/`)**:
    -   **èŒè´£**: æä¾›é«˜çº§ä»£ç ç†è§£èƒ½åŠ›ã€‚Vector Systemè´Ÿè´£å°†ä»£ç è½¬æ¢ä¸ºå‘é‡å¹¶è¿›è¡Œè¯­ä¹‰æœç´¢ã€‚Tree-sitterç”¨äºŽç²¾ç¡®è§£æžä»£ç çš„è¯­æ³•ç»“æž„ï¼ˆASTï¼‰ã€‚
    -   **å®žçŽ°**: è¿™äº›æ¨¡å—è¢«é«˜çº§å·¥å…·ï¼ˆå¦‚`SemanticSearchTool`å’Œ`FindClassTool`ï¼‰æ‰€ä½¿ç”¨ï¼Œä»¥æä¾›æ¯”ç®€å•æ–‡æœ¬åŒ¹é…æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚

## å…³é”®æŠ€æœ¯ç‰¹æ€§

### 1. è¯­ä¹‰æœç´¢å®žçŽ°
- **å‘é‡åµŒå…¥**: ä½¿ç”¨ Jina AI 1024 ç»´åµŒå…¥ (æŽ¨è) æˆ– OpenAI åµŒå…¥ (å·²å¼ƒç”¨)ã€‚
- **æŒ‰éœ€æž„å»º**: å‘é‡ç´¢å¼•ä»…åœ¨éœ€è¦æ—¶é€šè¿‡ `build_vector_index` å·¥å…·æž„å»ºï¼Œé¿å…ä¸å¿…è¦çš„å¯åŠ¨å»¶è¿Ÿã€‚
- **ä»£ç åˆ†å‰²**: åŸºäºŽ Moatless åº“çš„æ™ºèƒ½ä»£ç å—åˆ†å‰²ã€‚
- **ç›¸ä¼¼æ€§æœç´¢**: ä½¿ç”¨ FAISS å‘é‡æ•°æ®åº“å®žçŽ°é«˜æ•ˆæœç´¢ã€‚

### 2. çµæ´»çš„å®‰å…¨æ¨¡åž‹
- **ç™½åå•ç­–ç•¥**: é»˜è®¤å…è®¸è®¿é—®å¤šç§å¸¸è§ä»£ç ã€é…ç½®å’Œæ–‡æ¡£æ–‡ä»¶ç±»åž‹ã€‚
- **æ™ºèƒ½è·¯å¾„è¿‡æ»¤**: ä»…ç¦æ­¢æ ¸å¿ƒä¾èµ–å’Œç¼“å­˜ç›®å½• (`node_modules`, `.venv`, `__pycache__` ç­‰)ã€‚
- **å¯é…ç½®æ€§**: å¯ä»¥é€šè¿‡`Config`ç±»è½»æ¾è°ƒæ•´å®‰å…¨è®¾ç½®ã€‚

### 3. æ¨¡å—åŒ–å’Œå¯æ‰©å±•çš„å·¥å…·ç³»ç»Ÿ
- **å·¥å…·åŸºç±»**: `MCPTool`æä¾›äº†ä¸€ä¸ªæ¸…æ™°çš„æŽ¥å£ï¼Œç”¨äºŽåˆ›å»ºæ–°çš„è‡ªå®šä¹‰å·¥å…·ã€‚
- **é›†ä¸­æ³¨å†Œ**: `ToolRegistry`ä½¿å¾—æ·»åŠ å’Œç®¡ç†æ–°å·¥å…·å˜å¾—ç®€å•ã€‚

## ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€æ–‡ä»¶æ“ä½œ
```json
{
  "tool": "read_file",
  "arguments": {
    "file_path": "src/moatless_mcp/server.py",
    "start_line": 1,
    "end_line": 10
  }
}
```

### è¯­ä¹‰æœç´¢
```json
{
  "tool": "semantic_search",
  "arguments": {
    "query": "user authentication and login validation",
    "max_results": 5
  }
}
```

### ä»£ç ç»“æž„åˆ†æž
```json
{
  "tool": "find_class",
  "arguments": {
    "class_name": "ToolRegistry",
    "file_pattern": "**/registry.py"
  }
}
```

## éƒ¨ç½²ä¸Žå¼€å‘

å…³äºŽå¦‚ä½•è¿è¡Œæ­¤æœåŠ¡å™¨ã€è¿›è¡Œéƒ¨ç½²ä»¥åŠå¦‚ä½•å¼€å‘å’Œæ·»åŠ æ–°å·¥å…·çš„è¯¦ç»†è¯´æ˜Žï¼Œè¯·å‚é˜… **[README_deploy.md](README_deploy.md)**ã€‚

## ç›¸å…³æ–‡æ¡£

- **[MCP è§„èŒƒ](https://spec.modelcontextprotocol.io/)** - å®˜æ–¹ MCP åè®®è§„èŒƒ
- **[Moatless Tools](https://github.com/aorwall/moatless-tools)** - åº•å±‚è¯­ä¹‰æœç´¢åº“
- **[Tree-sitter](https://tree-sitter.github.io/tree-sitter/)** - ä»£ç è§£æžå™¨
- **[FAISS](https://faiss.ai/)** - å‘é‡ç›¸ä¼¼æ€§æœç´¢
